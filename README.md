# Relationship Variable Reward Scheduler

Monorepo for a multi-user relationship variable reward scheduler with:
- React + TypeScript web app
- Express + TypeScript API
- Python FastAPI scheduler logic service
- BullMQ worker for reminders
- MongoDB persistence
- Kubernetes + AWS deployment path

## Current Product Shape
- Event-centric dashboard with a left list + inspector workflow and right-side month calendar.
- Event configs replace template/category semantics; each profile has unique config slugs.
- One active upcoming event per event config (`SCHEDULED` or `RESCHEDULED`, future-dated).
- Events support API-backed update and hard delete, with optional explicit time (`hasExplicitTime`).
- Schedule settings are GUI-first: weekday allowed windows + recurring blackout weekdays + date-range blackouts.
- Future events are generated by queue-driven immediate triggers and a daily worker fallback scan.

## Current UI Workflow
- `Profiles` card: create-profile form is collapsed by default and expands inline from `New profile`.
- `Events` card: list is always visible, while `Event Builder` (inspector/editor) is toggle-open.
- `Calendar` card: month view with `Prev`/`Next`, `Go to month`, and `Schedule Settings` button.
- Schedule settings open in a modal from calendar top-right (not inline on the page).
- Upcoming events are shown below the calendar with hover trash-delete affordance (no confirmation prompt).
- Past events are shown under Upcoming and collapse into a drawer when long.

## Start Here
- Local startup and test runbook: `START_APP.md`
- Complete handoff guide for future agents: `docs/FUTURE_AGENTS.md`
- One-command local stack startup: `corepack pnpm local:start`
- End-to-end user workflow tests: `corepack pnpm --filter @reward/web test:e2e`
  - First-time setup: `corepack pnpm --filter @reward/web exec playwright install chromium`

## Documentation Index
- System architecture: `docs/architecture.md`
- Step-by-step AWS + Kubernetes deployment: `docs/deployment.md`
- AWS bill-shock prevention guardrails: `docs/aws-cost-guardrails.md`
- Security policy and vulnerability gates: `docs/security.md`

## Repository Layout
- `apps/web`: React web client
- `apps/api`: Express API
- `apps/worker`: BullMQ queue workers and reminder sender
- `apps/scheduler-py`: FastAPI adaptive scheduling service
- `packages/shared-types`: shared domain types and enums
- `packages/shared-validation`: shared Zod schemas
- `packages/shared-config`: shared env/config loading
- `packages/shared-email`: reminder email formatting
- `deploy/helm/relationship-reward`: Helm chart for web/api/worker/scheduler

## Security and Dependency Policy
- Use lockfile-pinned dependencies.
- CI scans JS/Python/deployment artifacts for vulnerabilities.
- CI fails on known vulnerabilities unless explicitly waived in `.security/waivers.yaml`.
- Waivers are temporary and must include owner, justification, and expiry.
